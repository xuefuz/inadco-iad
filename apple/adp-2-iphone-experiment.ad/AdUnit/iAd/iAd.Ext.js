/*
File: iAd.Ext.js

Abstract: iAd JS Extensions JS. 

Version: 1.2.3

Disclaimer: IMPORTANT:  This Apple software is supplied to you by Apple 
Inc. ("Apple") in consideration of your agreement to the following 
terms, and your use, installation, modification or redistribution of 
this Apple software constitutes acceptance of these terms.  If you do 
not agree with these terms, please do not use, install, modify or 
redistribute this Apple software. 

In consideration of your agreement to abide by the following terms, and 
subject to these terms, Apple grants you a personal, non-exclusive 
license, under Apple's copyrights in this original Apple software (the 
"Apple Software"), to use, reproduce, modify and redistribute the Apple 
Software, with or without modifications, in source and/or binary forms; 
provided that if you redistribute the Apple Software in its entirety and 
without modifications, you must retain this notice and the following 
text and disclaimers in all such redistributions of the Apple Software. 
Neither the name, trademarks, service marks or logos of Apple Inc. may 
be used to endorse or promote products derived from the Apple Software 
without specific prior written permission from Apple.  Except as 
expressly stated in this notice, no other rights or licenses, express or 
implied, are granted by Apple herein, including but not limited to any 
patent rights that may be infringed by your derivative works or by other 
works in which the Apple Software may be incorporated. 

The Apple Software is provided by Apple on an "AS IS" basis.  APPLE 
MAKES NO WARRANTIES, EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION 
THE IMPLIED WARRANTIES OF NON-INFRINGEMENT, MERCHANTABILITY AND FITNESS 
FOR A PARTICULAR PURPOSE, REGARDING THE APPLE SOFTWARE OR ITS USE AND 
OPERATION ALONE OR IN COMBINATION WITH YOUR PRODUCTS. 

IN NO EVENT SHALL APPLE BE LIABLE FOR ANY SPECIAL, INDIRECT, INCIDENTAL 
OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF 
SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS 
INTERRUPTION) ARISING IN ANY WAY OUT OF THE USE, REPRODUCTION, 
MODIFICATION AND/OR DISTRIBUTION OF THE APPLE SOFTWARE, HOWEVER CAUSED 
AND WHETHER UNDER THEORY OF CONTRACT, TORT (INCLUDING NEGLIGENCE), 
STRICT LIABILITY OR OTHERWISE, EVEN IF APPLE HAS BEEN ADVISED OF THE 
POSSIBILITY OF SUCH DAMAGE. 

Copyright (C) 2012 Apple Inc. All Rights Reserved. 

*/

iAd.Ext={};iAd.Ext.VERSION="1.2.3";iAd.Ext.IS_IN_ADSHEET=window.hasOwnProperty("ad");iAd.Ext.DEVICE_PATH=iAd.Device.IS_IPAD?"ipad/":"iphone/";iAd.Ext.CSS_PATH="css/"+iAd.Ext.DEVICE_PATH;iAd.Ext.ASSET_PATH="assets/"+iAd.Ext.DEVICE_PATH;iAd.Ext.HAS_4_INCH_DISPLAY=window.screen.width==568||window.screen.height==568;iAd.Class({name:"iAd.Ext.AnalyticsManager",superclass:iAd.Object,synthesizedProperties:["logsToConsole","disableAutomaticEvents","eventDictionary"]});
iAd.Ext.AnalyticsManager.prototype.init=function(a){this.callSuper();this.referenceObject=null;this.eventDictionary={};this.rootViewController=a;this.rootViewController.addEventListener(iAd.ViewController.VIEW_DID_APPEAR_EVENT,this,false);this.disableAutomaticEvents=this.logsToConsole=true};iAd.Ext.AnalyticsManager.prototype.setLogsToConsole=function(a){if(a!=this._logsToConsole)this._logsToConsole=a,iAd.Analytics.logsToConsole=a};
iAd.Ext.AnalyticsManager.prototype.setDisableAutomaticEvents=function(a){if(a!=this._disableAutomaticEvents)this._disableAutomaticEvents=a};iAd.Ext.AnalyticsManager.prototype.setEventDictionary=function(a){!a||typeof a!="object"?console.error("[ANALYTICS ERROR]: You must pass in a valid event dictionary."):this._eventDictionary=a};
iAd.Ext.AnalyticsManager.prototype.handleEvent=function(a){!this.disableAutomaticEvents&&a.type==iAd.ViewController.VIEW_DID_APPEAR_EVENT&&(a.ad.sender.id.indexOf("vc-")>-1&&console.warn('[ANALYTICS WARNING]: View controller "'+a.ad.sender.id+'" should have a human readable configuration id.'),iAd.Analytics.log({analyticsObjectId:a.ad.sender.id+"ViewDidAppear",analyticsSectionId:a.ad.sender.id,analyticsType:"view",analyticsName:"viewDidAppear"}))};
iAd.Ext.AnalyticsManager.prototype.verifyReferenceObject=function(a){return a.hasOwnProperty("analyticsObjectId")&&a.hasOwnProperty("analyticsSectionId")&&a.hasOwnProperty("analyticsName")&&a.hasOwnProperty("analyticsType")};iAd.Ext.AnalyticsManager.prototype.stripNullArguments=function(a){a.hasOwnProperty("additionalArguments")&&a.additionalArguments===null&&delete a.additionalArguments;return a};
iAd.Ext.AnalyticsManager.prototype.resolveObjectPath=function(a){if(!(a[0]==="."||a[0]==="")){for(var a=a.split("."),b=this.eventDictionary,c=0,d=a.length;c<d;c++)if(b.hasOwnProperty(a[c]))b=b[a[c]];else return false;return b}};
iAd.Ext.AnalyticsManager.prototype.logMessage=function(a){!a||typeof a!=="string"?console.error("[ANALYTICS ERROR]: a reference object string must be passed in.  Event will not be sent to server."):(this.referenceObject=this.resolveObjectPath(a))?(this.referenceObject=this.stripNullArguments(this.referenceObject),this.verifyReferenceObject(this.referenceObject)?iAd.Analytics.log(this.referenceObject):(console.error("[ANALYTICS ERROR]: Reference event is invalid. Event will not be sent to server."),
console.error("[ANALYTICS ERROR]: Passed reference string",'"'+this.referenceObject+'"')),this.referenceObject=null):iAd.Console.error('[ANALYTICS ERROR]: Reference object "'+a+'" not found.  Make sure your string is a valid object path.')};iAd.Ext.Console=iAd.Ext.Console||{};iAd.Ext.Console.assert=iAd.Console.assert||function(){if(window.console&&console.assert)console.assert.apply(console,arguments);else if(!arguments[0])throw"Assertion failed: "+(arguments[1]||"");};
iAd.Class({name:"iAd.Ext.LocalizationViewProcessor",superclass:iAd.ViewProcessor});iAd.Ext.LocalizationViewProcessor.LOCALIZATION_KEY="ad-ext-localization-key";iAd.Ext.LocalizationViewProcessor.prototype.init=function(a){this.callSuper(a);this.processedNodes=[]};
iAd.Ext.LocalizationViewProcessor.prototype.processView=function(a){this.callSuper(a);if(!iAd.Ext.LocalizationViewProcessor._localizationContent||!iAd.Ext.LocalizationViewProcessor._localizationCode)throw Error("Localization: A localization code and a localization content object must be registered.");for(var b=iAd.Ext.LocalizationViewProcessor.LOCALIZATION_KEY,a=a.layer.querySelectorAll("["+(iAd.Element.HTML5_CUSTOM_ATTRIBUTE_PREFIX+b)+"],["+b+"]"),c=iAd.Ext.LocalizationViewProcessor._localizationContent,
d=iAd.Ext.LocalizationViewProcessor._localizationCode,f=0;f<a.length;f++){var g=a[f];if(!g.hasOwnProperty("_adProcessedLocalizedNode")){var e=iAd.Element.getCustomAttribute(g,b);if(c[d].hasOwnProperty(e))g.innerHTML=c[d][e];g._adProcessedLocalizedNode=true;this.processedNodes.push(g)}}};iAd.Ext.LocalizationViewProcessor.registerLocalizationSource=function(a,b){this._localizationCode=a;this._localizationContent=b};
iAd.Ext.LocalizationViewProcessor.prototype.cleanUp=function(){this.callSuper();for(var a;a=this.processedNodes.pop();)delete a._adProcessedLocalizedNode};iAd.Class({name:"iAd.Ext.TemplateActivityIndicatorView",superclass:iAd.ActivityIndicatorView,cssClassName:"ad-ext-template-activity-indicator-view"});iAd.Ext.TemplateActivityIndicatorView.prototype.init=function(a){this.callSuper(a,iAd.ActivityIndicatorView.STYLE_CUSTOM)};iAd.Class({name:"iAd.Ext.AdController",superclass:iAd.RootViewController});
iAd.Ext.AdController.LOADING_CSS_CLASS_NAME="ad-ext-loading";
iAd.Ext.AdController.prototype.init=function(a){this.callSuper();this.localizationContent=a.localizationContent;this.config=a.config;this.viewControllers=iAd.ViewController.instances;this.analytics=new iAd.Ext.AnalyticsManager(this);this.localization=null;this.config.isConsoleLoggingEnabled===void 0||this.config.isConsoleLoggingEnabled||this._disableConsoleLogging();this.config.versionCode&&document.body.addClassName(this.config.versionCode);!iAd.Ext.IS_IN_ADSHEET&&this.config.isiPad&&this.forceIsiPad();
!iAd.Ext.IS_IN_ADSHEET&&this.config.isLandscape&&this.forceLandscape();!iAd.Ext.IS_IN_ADSHEET&&!this.config.isiPad&&this.config.isiPhone4Inch&&this.handleiPhone4InchDisplay();this.config.locale&&this.localizationContent&&this.setupLocalization(this.config.locale,this.localizationContent);this._createSharedLoadingIndicator();iAd.Device.IS_IPAD||document.body.addClassName("ad-iPhone");iAd.Ext.HAS_4_INCH_DISPLAY&&this.handleiPhone4InchDisplay();if(a.analyticsEvents)this.analytics.eventDictionary=a.analyticsEvents;
this.callMethodNameAfterDelay("didCompleteSetup",0)};iAd.Ext.AdController.prototype.createViewController=function(a,b,c){c.id=b;iAd.Ext.Console.assert(!this.viewControllers[b],"[iAd.Ext.AdController] View Controller with duplicate id created: "+b);return new a(c)};iAd.Ext.AdController.prototype.loadViewController=function(a,b){a.requiredFilesLoadDelegate=b||this;a.loadRequiredFiles()};
iAd.Ext.AdController.prototype.showViewController=function(a,b){var c;a!==this.transitionController.visibleViewController&&this.transitionController.setVisibleViewControllerAnimated(a,b!==void 0?b:true)};iAd.Ext.AdController.prototype.cacheViewController=function(a){for(var b=this.transitionController.cachedViewControllers||[],c=0,d=b.length;c<d;c++)if(view_controller===b[c])return;this.transitionController.cachedViewControllers=b.concat([a])};
iAd.Ext.AdController.prototype.uncacheViewController=function(){for(var a=this.transitionController.cachedViewControllers,b=0,c=a.length;b<c;b++)if(view_controller===a[b]){this.transitionController.cachedViewControllers=a.splice(b,1);break}};iAd.Ext.AdController.prototype.addSubviewToRoot=function(a){this.view.addSubview(a)};
iAd.Ext.AdController.prototype.showLoadingIndicator=function(){iAd.RootView.sharedRoot.layer.addClassName(iAd.Ext.AdController.LOADING_CSS_CLASS_NAME);this.sharedLoadingIndicator.applyTransition(iAd.View.TRANSITION_DISSOLVE_IN);this.sharedLoadingIndicator.animating=true};
iAd.Ext.AdController.prototype.hideLoadingIndicator=function(){iAd.RootView.sharedRoot.layer.removeClassName(iAd.Ext.AdController.LOADING_CSS_CLASS_NAME);this.sharedLoadingIndicator.applyTransition(iAd.View.TRANSITION_DISSOLVE_OUT).delegate=this};iAd.Ext.AdController.prototype.didCompleteSetup=function(){};iAd.Ext.AdController.prototype.transitionDidComplete=function(){this.sharedLoadingIndicator.animating=false};
iAd.Ext.AdController.prototype.transitionControllerDidMakeViewControllerVisibleAnimated=function(a,b){var c=b.configuration.shouldAutoHideLoadingIndicator;(c==void 0||c)&&this.hideLoadingIndicator()};iAd.Ext.AdController.prototype._createSharedLoadingIndicator=function(){var a=new iAd.Ext.TemplateActivityIndicatorView;a.layer.id="root-loading-indicator";a.hidesWhenStopped=true;a.hidden=true;this.view.addSubview(a);this.sharedLoadingIndicator=a};
iAd.Ext.AdController.prototype.setupLocalization=function(a,b){document.body.addClassName(a);b.iPhone&&!iAd.Device.IS_IPAD?b=b.iPhone:b.iPad&&iAd.Device.IS_IPAD?b=b.iPad:(b.iPhone||b.iPad)&&console.warn("[iAd.Ext.AdController] Localized content for device missing!");iAd.ViewController.addViewProcessor(iAd.Ext.LocalizationViewProcessor);iAd.Ext.LocalizationViewProcessor.registerLocalizationSource(a,b)};
iAd.Ext.AdController.prototype.forceIsiPad=function(){iAd.Device.IS_IPAD=true;document.body.addClassName("ad-iPad");iAd.Ext.DEVICE_PATH=iAd.Device.IS_IPAD?"ipad/":"iphone/";iAd.Ext.CSS_PATH="css/"+iAd.Ext.DEVICE_PATH;iAd.Ext.ASSET_PATH="assets/"+iAd.Ext.DEVICE_PATH};iAd.Ext.AdController.prototype.forceLandscape=function(){iAd.Device.setInterfaceOrientation(iAd.Device.ORIENTATION_LANDSCAPE_LEFT)};iAd.Ext.AdController.prototype.handleiPhone4InchDisplay=function(){document.body.addClassName("ad-4-inch")};
iAd.Ext.AdController.prototype._disableConsoleLogging=function(){var a=function(){},b=Object.getPrototypeOf(console);for(n in b)console[n]=a};iAd.Class({name:"iAd.Ext.FeedLoader",superclass:iAd.XHRLoader,mixins:[iAd.EventTarget],synthesizedProperties:["useDev","protocolType"]});iAd.Ext.FeedLoader.HTTP_URL_PREFIX="http://";iAd.Ext.FeedLoader.HTTPS_URL_PREFIX="https://";iAd.Ext.FeedLoader.USE_HTTP=false;iAd.Ext.FeedLoader.USE_HTTPS=true;iAd.Ext.FeedLoader.PROD_URL="iadfeed.qwapi.com/feedserverUtils/psFeedHandler.jsp";
iAd.Ext.FeedLoader.DEV_URL="psfeed.qwapi.com/feedserverUtils/psFeedHandler.jsp";iAd.Ext.FeedLoader.FORMAT_JSON="json";iAd.Ext.FeedLoader.FORMAT_XML="xml";iAd.Ext.FeedLoader.FORMAT="format";iAd.Ext.FeedLoader.CLASS="class";iAd.Ext.FeedLoader.METHOD="method";
iAd.Ext.FeedLoader.prototype.init=function(a,b,c,d,f){iAd.Ext.Console.assert(b,"iAd.Ext.FeedLoader.init: Failed to provide method. Was: "+b);iAd.Ext.Console.assert(c,"iAd.Ext.FeedLoader.init: Failed to provide feedFormat. Was: "+c);iAd.Ext.Console.assert(d,"iAd.Ext.FeedLoader.init: Failed to provide feedClassName. Was: "+d);this.params=f?f:{};this.params[iAd.Ext.FeedLoader.METHOD]=b;this.params[iAd.Ext.FeedLoader.FORMAT]=c;this.params[iAd.Ext.FeedLoader.CLASS]=d;this.callSuper("",a,this.params);this.protocolType=
iAd.Ext.FeedLoader.USE_HTTP;this.useDev=false};iAd.Ext.FeedLoader.prototype.setProtocolType=function(a){if(a==iAd.Ext.FeedLoader.USE_HTTPS||a==iAd.Ext.FeedLoader.USE_HTTP)this._protocolType=a};iAd.Ext.FeedLoader.prototype.load=function(){this.url=(this.protocolType?iAd.Ext.FeedLoader.HTTPS_URL_PREFIX:iAd.Ext.FeedLoader.HTTP_URL_PREFIX)+(this.useDev?iAd.Ext.FeedLoader.DEV_URL:iAd.Ext.FeedLoader.PROD_URL);this.callSuper()};iAd.Class({name:"iAd.Ext.ImageViewProcessor",superclass:iAd.ViewProcessor});
iAd.Ext.ImageViewProcessor.prototype.init=function(a){this.callSuper(a);this.processedImages=[]};iAd.Ext.ImageViewProcessor.IMAGE_SRC="ad-ext-image-src";iAd.Ext.ImageViewProcessor.LOCALIZED_IMAGE="ad-ext-localized-image";iAd.Ext.ImageViewProcessor.IMAGE_SRC_DEVICE=iAd.Device.IS_IPAD?"ad-ext-image-src-ipad":"ad-ext-image-src-iphone";
iAd.Ext.ImageViewProcessor.prototype.processView=function(a){this.callSuper(a);for(var b=iAd.Ext.ImageViewProcessor.IMAGE_SRC,c=iAd.Element.HTML5_CUSTOM_ATTRIBUTE_PREFIX+iAd.Ext.ImageViewProcessor.IMAGE_SRC_DEVICE,d=iAd.Element.HTML5_CUSTOM_ATTRIBUTE_PREFIX+iAd.Ext.ImageViewProcessor.LOCALIZED_IMAGE,a=a.layer.querySelectorAll("["+(iAd.Element.HTML5_CUSTOM_ATTRIBUTE_PREFIX+b)+"],["+b+"],["+c+"]"),f=0,g=a.length;f<g;f++){var e=a[f];if(!e.hasOwnProperty("_adProcessedImage")){var h=iAd.Element.getCustomAttribute(e,
b)||iAd.Element.getCustomAttribute(e,c);iAd.Element.hasCustomAttribute(e,d)&&(h=iAd.Ext.Utils.appendLocalizationCodeSuffix(h));if(e.nodeName=="IMG")e.src=h?this.resolveImagePath(h):"";else{for(var h=h.split(/\s*,\s*/),i=[],j;j=h.shift();)i.push('url(" '+this.resolveImagePath(j)+' ")');background_image_src=i.join(",");e.style.backgroundImage=background_image_src}e._adProcessedImage=true;this.processedImages.push(e)}}};
iAd.Ext.ImageViewProcessor.prototype.resolveImagePath=function(a){return iAd.Device.HAS_HIDPI_DISPLAY?iAd.Ext.ASSET_PATH+iAd.Path.appendHiDPISuffix(a):iAd.Ext.ASSET_PATH+a};iAd.Ext.ImageViewProcessor.prototype.cleanUp=function(){this.callSuper();for(var a;a=this.processedImages.pop();)delete a._adProcessedImage};iAd.ViewController.addViewProcessor(iAd.Ext.ImageViewProcessor);iAd.Class({name:"iAd.Ext.MapAnnotation",synthesizedProperties:["formattedAnnotation"]});
iAd.Ext.MapAnnotation.PIN_COLOR_RED="red";iAd.Ext.MapAnnotation.PIN_COLOR_GREEN="green";iAd.Ext.MapAnnotation.PIN_COLOR_PURPLE="purple";
iAd.Ext.MapAnnotation.prototype.init=function(a){this.callSuper();this._formattedAnnotation=null;this.latitude=a.latitude;this.longitude=a.longitude;this.identifier=a.identifier.toString();this.pinColor=a.pinColor||iAd.Ext.MapAnnotation.PIN_COLOR_RED;this.imageURL=a.imageURL?iAd.Path.resolveAbsolutePath(iAd.Ext.ASSET_PATH+a.imageURL):null;this.xOffset=a.xOffset;this.yOffset=a.yOffset;this.title=a.title||"";this.subtitle=a.subtitle||"";this.hasLeftCalloutButton=a.hasLeftCalloutButton===void 0||!!a.hasLeftCalloutButton;
this.hasRightCalloutButton=a.hasRightCalloutButton||false};iAd.Ext.MapAnnotation.prototype.getFormattedAnnotation=function(){return{latitude:this.latitude,longitude:this.longitude,identifier:this.identifier,pinColor:this.pinColor,imageURL:this.imageURL,xOffset:this.xOffset,yOffset:this.yOffset,title:this.title,subtitle:this.subtitle,hasLeftCalloutButton:this.hasLeftCalloutButton,hasRightCalloutButton:this.hasRightCalloutButton}};
iAd.Ext.MapAnnotation.annotationFromLocation=function(a){return{latitude:a.loc.latitude,longitude:a.loc.longitude,identifier:a.id,title:"",subtitle:"",pinColor:"",imageURL:null,xOffset:"",yOffset:"",hasLeftCalloutButton:true,hasRightCalloutButton:false}};iAd.Ext.MapAnnotation.createAnnotationForMap=function(a){return new (iAd.Ext.Map.SUPPORTS_MAP_PLUGIN||window.BrowserMap?iAd.Ext.MapAnnotation:iAd.Ext.LegacyMapAnnotation)(a)};iAd.Class({name:"iAd.Ext.MapRegion",synthesizedProperties:["formattedMapRegion"]});
iAd.Ext.MapRegion.prototype.init=function(a,b,c,d){this.callSuper();this._formattedMapRegion=null;this.latitude=a;this.longitude=b;this.latDelta=c;this.longDelta=d};iAd.Ext.MapRegion.prototype.getFormattedMapRegion=function(){return{latitude:this.latitude,longitude:this.longitude,latitudeDelta:this.latDelta,longitudeDelta:this.longDelta}};
iAd.Ext.MapRegion.prototype.equals=function(a){return this.latititude==a.latitude&&this.longitude==a.longitude&&this.latDelta==a.latitudeDelta&&this.longDelta==a.longitudeDelta};iAd.Ext.MapRegion.US=new iAd.Ext.MapRegion(37.33,-100,45,45);
iAd.Ext.MapRegion.regionFromAnnotations=function(a){var b,c,d,f,g=a.length;if(!(g<=0)){b=Number.MAX_VALUE;c=Number.MAX_VALUE;d=-Number.MAX_VALUE;f=-Number.MAX_VALUE;for(var e=0;e<g;e++)b=Math.min(b,a[e].latitude),c=Math.min(c,a[e].longitude),d=Math.max(d,a[e].latitude),f=Math.max(f,a[e].longitude);return new iAd.Ext.MapRegion(b+(d-b)/2,c+(f-c)/2,g>1?(d-b)*1.25:0.08,g>1?(f-c)*1.25:0.08)}};
iAd.Class({name:"iAd.Ext.Map",mixins:[iAd.EventTarget],synthesizedProperties:["mapRegion","mapType","showsUserLocation","hidden","selectedAnnotationId"]});iAd.Ext.Map.CREATE_ANNOTATIONS_METHOD="createCustomizedAnnotation";iAd.Ext.Map.DID_ADD_ANNOTATIONS="mapDidAddViewsForAnnotations";iAd.Ext.Map.DID_UPDATE_USER_LOCATION="mapDidUpdateUserLocation";iAd.Ext.Map.UPDATE_USER_LOCATION_FAILED="mapUpdateUserLocationFailed";iAd.Ext.Map.DID_SELECT_ANNOTATION="mapDidSelectAnnotation";
iAd.Ext.Map.DID_DESELECT_ANNOTATION="mapDidDeselectAnnotation";iAd.Ext.Map.ANNOTATION_LEFT_CALLOUT_TAPPED="mapAnnotationLeftCalloutTapped";iAd.Ext.Map.ANNOTATION_RIGHT_CALLOUT_TAPPED="mapAnnotationRightCalloutTapped";iAd.Ext.Map.REGION_DID_CHANGE="mapRegionDidChange";iAd.Ext.Map.LEGACY_ANNOTATION_CALLOUT_TAPPED="mapAnnotationCalloutTapped";iAd.Ext.Map.SUPPORTS_MAP_PLUGIN=navigator.mimeTypes["application/x-geomap"];iAd.Ext.Map.CSS_CLASS_NAME="ad-ext-map";
iAd.Ext.Map.MAP_TYPES_ENUM={standard:0,satellite:1,hybrid:2,"not-initialized":-1};iAd.Ext.Map.prototype.init=function(){this.callSuper();this._mapRegion=iAd.Ext.MapRegion.US;this._mapType="";this._hidden=this._mapShouldUpdateAnnotations=this._mapHasBeenShown=this._showsUserLocation=false;this.delegate=this._element=this._userLocation=this._selectedAnnotationId=null;this.annotationsArray=[];this.createMap()};
iAd.Ext.Map.prototype.createMap=function(){var a=this._element=document.createElement("object");a.type="application/x-geomap";a.addClassName(iAd.Ext.Map.CSS_CLASS_NAME)};iAd.Ext.Map.prototype.appendMapToView=function(a){a.appendChild(this._element)};
iAd.Ext.Map.prototype.mapWasInsertedIntoDocument=function(){this._element.listener=this;if(this._mapType)this._element.mapType=iAd.Ext.Map.MAP_TYPES_ENUM[this._mapType];if(this._userLocation)this._element.showsUserLocation=this._showsUserLocation;if(this._mapRegion)this._mapShouldUpdateAnnotations=this.annotationsArray.length>0,this.mapRegion=this._mapRegion};
iAd.Ext.Map.prototype.setShowsUserLocation=function(a){if(this._showsUserLocation!=a&&(this._showsUserLocation=a,iAd.Ext.IS_IN_ADSHEET))this._element.showsUserLocation=a};iAd.Ext.Map.prototype.setSelectedAnnotationId=function(a){if(this._selectedAnnotationId!=a)this._selectedAnnotationId=a};
iAd.Ext.Map.prototype.setMapType=function(a){if(this._mapType!=a){var b=iAd.Ext.Map.MAP_TYPES_ENUM.hasOwnProperty(a)?a:"standard";this._element.mapType=iAd.Ext.Map.MAP_TYPES_ENUM[b];this._mapType=b;this._mapType!==a&&iAd.Console.warn("The mapType: "+a+" is not a supported map type. The default mapType will be used")}};iAd.Ext.Map.prototype.setMapRegion=function(a){this.setMapRegionAnimated(a,true)};
iAd.Ext.Map.prototype.setMapRegionAnimated=function(a,b){if(a&&!this._mapRegion.equals(a))this._mapRegion=a,this._element.setRegion(a.formattedMapRegion,b)};iAd.Ext.Map.prototype.setHidden=function(a){this._element.style.visibility=a?"hidden":"visible"};iAd.Ext.Map.prototype.centerMapByCoordinate=function(a,b){try{this._element.setCenterCoordinate(a,b)}catch(c){iAd.Console.error("iAd.Ext.Map: Unable to center map by coordinate. Error: "+c)}};
iAd.Ext.Map.prototype.zoomToAnnotations=function(a,b){this.removeAnnotations();for(var c=0,d=a.length;c<d;c++)this.addAnnotationToArray(this.sanitizeAnnotation(a[c]));this._mapShouldUpdateAnnotations=true;this.setMapRegionAnimated(iAd.Ext.MapRegion.regionFromAnnotations(this.annotationsArray),b)};iAd.Ext.Map.prototype.sanitizeAnnotation=function(a){return iAd.Ext.MapAnnotation.createAnnotationForMap(a)};iAd.Ext.Map.prototype.addAnnotationToArray=function(a){this.annotationsArray.push(a.formattedAnnotation)};
iAd.Ext.Map.prototype.removeAnnotationFromArrayWithId=function(a){for(var b=0,c=this.annotationsArray.length;b<c;b++)if(this.annotationsArray[b].identifier==a)return iAd.Array.removeObjectFromArray(this.annotationsArray[b],this.annotationsArray),true;return false};iAd.Ext.Map.prototype.addAnnotations=function(a){try{this._element.addAnnotations(a)}catch(b){console.error("iAd.Ext.Map: Unable to add annotations to map. Error: "+b)}};
iAd.Ext.Map.prototype.addAnnotation=function(a){try{this._element.addAnnotation(a),this.addAnnotationToArray(this.sanitizeAnnotation(a))}catch(b){console.error("iAd.Ext.Map: Unable to add annotation to map. Error: "+b)}};
iAd.Ext.Map.prototype.removeAnnotations=function(){for(var a=[],b=0,c=this.annotationsArray.length;b<c;b++)a.push(this.annotationsArray[b].identifier);try{this._element.removeAnnotations(a)}catch(d){console.error("iAd.Ext.Map: Unable to remove annotations from map. Error: "+d)}this.annotationsArray=[]};
iAd.Ext.Map.prototype.removeAnnotationWithId=function(a){try{this._element.removeAnnotation(a),this.removeAnnotationFromArrayWithId(a)}catch(b){console.error("iAd.Ext.Map: Unable to remove annotation from map. Error: "+b)}};iAd.Ext.Map.prototype.selectAnnotationWithId=function(a,b){try{this._element.selectAnnotation(a,b)}catch(c){console.error("iAd.Ext.Map: Unable to select annotation with id: "+a+". Error: "+c)}};
iAd.Ext.Map.prototype.deselectAnnotationWithId=function(a){try{this._element.deselectAnnotation(a)}catch(b){console.error("iAd.Ext.Map: Unable to deselect annotation with id: "+a+". Error: "+b)}};iAd.Ext.Map.prototype.mapShouldUpdateLayoutInView=function(){};
iAd.Ext.Map.prototype.mapDidUpdateUserLocation=function(a){if(this._userLocation===null)this.setMapRegionAnimated(new iAd.Ext.MapRegion(a.latitude,a.longitude,5,5),true),this._userLocation=a,this.dispatchNotification(iAd.Ext.Map.DID_UPDATE_USER_LOCATION,this.delegate,[["latitude",a.latitude],["longitude",a.longitude]])};iAd.Ext.Map.prototype.mapDidSelectAnnotation=function(a){this._selectedAnnotationId=a;this.dispatchNotification(iAd.Ext.Map.DID_SELECT_ANNOTATION,this.delegate,[["identifier",a]])};
iAd.Ext.Map.prototype.mapDidDeselectAnnotation=function(a){this._selectedAnnotationId=null;this.dispatchNotification(iAd.Ext.Map.DID_DESELECT_ANNOTATION,this.delegate,[["identifier",a]])};
iAd.Ext.Map.prototype.mapRegionDidChange=function(a){if(this.annotationsArray.length&&this._mapShouldUpdateAnnotations)this.addAnnotations(this.annotationsArray),this._mapShouldUpdateAnnotations=false;this._mapRegion=new iAd.Ext.MapRegion(a.latitude,a.longitude,a.latitudeDelta,a.longitudeDelta);this.dispatchNotification(iAd.Ext.Map.REGION_DID_CHANGE,this.delegate,[["region",a]])};
iAd.Ext.Map.prototype.mapDidAddViewsForAnnotations=function(a){this.dispatchNotification(iAd.Ext.Map.DID_ADD_ANNOTATIONS,this.delegate,[["identifiers",a]])};iAd.Ext.Map.prototype.mapUpdateUserLocationFailed=function(){this.dispatchNotification(iAd.Ext.Map.UPDATE_USER_LOCATION_FAILED,this.delegate)};iAd.Ext.Map.prototype.mapAnnotationLeftCalloutTapped=function(a){this.dispatchNotification(iAd.Ext.Map.ANNOTATION_LEFT_CALLOUT_TAPPED,this.delegate,[["annotationId",a]])};
iAd.Ext.Map.prototype.mapAnnotationRightCalloutTapped=function(a){this.dispatchNotification(iAd.Ext.Map.ANNOTATION_RIGHT_CALLOUT_TAPPED,this.delegate,[["annotationId",a]])};iAd.Ext.Map.mapFactory=function(){return new (iAd.Ext.IS_IN_ADSHEET?iAd.Ext.Map.SUPPORTS_MAP_PLUGIN?iAd.Ext.Map:iAd.Ext.LegacyMap:window.BrowserMap?window.BrowserMap:iAd.Ext.LegacyMap)};iAd.Class({name:"iAd.Ext.LegacyMap",superclass:iAd.Ext.Map});iAd.Ext.LegacyMap.LEGACY_ANNOTATION_CALLOUT_TAPPED="mapAnnotationCalloutTapped";
iAd.Ext.LegacyMap.prototype.init=function(){this.callSuper();this._mapHasBeenShown=false};iAd.Ext.LegacyMap.prototype.createMap=function(){if(iAd.Ext.IS_IN_ADSHEET)this._element=ad.map};iAd.Ext.LegacyMap.prototype.appendMapToView=function(){};iAd.Ext.LegacyMap.prototype.mapWasInsertedIntoDocument=function(){if(iAd.Ext.IS_IN_ADSHEET)this._element.listener=this,this.hidden=false,this._element.showsUserLocation=this._showsUserLocation};
iAd.Ext.LegacyMap.prototype.setMapRegion=function(a){this._mapRegion!=a&&this.setMapRegionAnimated(a.formattedMapRegion)};iAd.Ext.LegacyMap.prototype.setMapRegionAnimated=function(a){if(iAd.Ext.IS_IN_ADSHEET)this._mapRegion=a,this._element.region=a};iAd.Ext.LegacyMap.prototype.setMapType=function(){};iAd.Ext.LegacyMap.prototype.setHidden=function(a){if(iAd.Ext.IS_IN_ADSHEET)this._element.hidden=a?true:false};
iAd.Ext.LegacyMap.prototype.sanitizeAnnotation=function(a){return iAd.Ext.MapAnnotation.createAnnotationForMap({latitude:a.latitude,longitude:a.longitude,id:a.identifier,title:a.title,subtitle:a.subtitle,listener:this,imageURL:a.imageURL})};
iAd.Ext.LegacyMap.prototype.zoomToAnnotations=function(a){if(iAd.Ext.IS_IN_ADSHEET){this.removeAnnotations();for(var b=0,c=a.length;b<c;b++)this.addAnnotationToArray(this.sanitizeAnnotation(a[b]));this._element.addAnnotations(this.annotationsArray);this.mapRegion=iAd.Ext.MapRegion.regionFromAnnotations(this.annotationsArray)}else iAd.Console.log("iAd.Ext.MapView #zoomToAnnotations method called.")};
iAd.Ext.LegacyMap.prototype.removeAnnotations=function(){if(this.annotationsArray.length)for(;this.annotationsArray.length>0;)this._element.removeAnnotation(this.annotationsArray.pop().identifier);this.annotationsArray=[]};iAd.Ext.LegacyMap.prototype.mapShouldUpdateLayoutInView=function(a,b){if(iAd.Ext.IS_IN_ADSHEET)this._element.frame=new MapRect(b.x,b.y,a.width,a.height)};iAd.Ext.LegacyMap.prototype.mapRegionDidChange=function(){};iAd.Ext.LegacyMap.prototype.mapAnnotationCalloutTapped=function(a){this.mapAnnotationLeftCalloutTapped(a)};
iAd.Class({name:"iAd.Ext.LegacyMapAnnotation",superclass:iAd.Ext.MapAnnotation});iAd.Ext.LegacyMapAnnotation.prototype.init=function(a){this._formattedAnnotation=null;this.latitude=a.latitude;this.longitude=a.longitude;this.title=a.title||"";this.subtitle=a.subtitle||"";this.id=a.id.toString();this.imageURL=a.imageURL?iAd.Path.resolveAbsolutePath(iAd.Ext.ASSET_PATH+a.imageURL):null;this.listener=a.listener;this.callSuper()};
iAd.Ext.LegacyMapAnnotation.prototype.getFormattedAnnotation=function(){return!iAd.Ext.IS_IN_ADSHEET?void 0:new MapAnnotation(this.latitude,this.longitude,this.title,this.subtitle,this.id,this.listener,this.imageURL)};iAd.Class({name:"iAd.Ext.LocationLoader",superclass:iAd.Ext.FeedLoader});iAd.Ext.LocationLoader.ERROR_NO_LOCATIONS=4;iAd.Ext.LocationLoader.ERROR_BAD_DATA=5;iAd.Ext.LocationLoader.CLASS_CALL="com.qwapi.feeds.mongo.StoreLocator";iAd.Ext.LocationLoader.METHOD_CORD_CALL="getStoreLocations";
iAd.Ext.LocationLoader.METHOD_ZIP_CALL="getStoreLocationsByZip";iAd.Ext.LocationLoader.LATITUDE="lat";iAd.Ext.LocationLoader.LONGITUDE="lon";iAd.Ext.LocationLoader.ZIP_CODE="zip";iAd.Ext.LocationLoader.RADIUS="radius";iAd.Ext.LocationLoader.MAX="max";iAd.Ext.LocationLoader.SID="sid";
iAd.Ext.LocationLoader.prototype.init=function(a,b,c,d){iAd.Ext.Console.assert(a,"iAd.Ext.LocationLoader.init: Failed to provide SID.");this.zipCode=this.longitude=this.latitude=-1;this.myParams=d?d:{};this.myParams[iAd.Ext.LocationLoader.SID]=a||"demo";this.myParams[iAd.Ext.LocationLoader.RADIUS]=b||100;this.myParams[iAd.Ext.LocationLoader.MAX]=c||10;this.callSuper("GET",iAd.Ext.LocationLoader.METHOD_CORD_CALL,iAd.Ext.FeedLoader.FORMAT_JSON,iAd.Ext.LocationLoader.CLASS_CALL,this.myParams)};
iAd.Ext.LocationLoader.prototype.getLocationsByZip=function(a){iAd.Ext.Console.assert(a,"iAd.Ext.LocationLoader.getLocationsByZip: Failed to provide zipCode.");var b={};iAd.Utils.copyPropertiesFromSourceToTarget(this.myParams,b);b[iAd.Ext.FeedLoader.METHOD]=iAd.Ext.LocationLoader.METHOD_ZIP_CALL;b[iAd.Ext.LocationLoader.ZIP_CODE]=a;this.params=b;this.load()};
iAd.Ext.LocationLoader.prototype.getLocationsByCoordinate=function(a,b){iAd.Ext.Console.assert(a,"iAd.Ext.LocationLoader.getLocationsByCoordinate: Failed to provide latitude.");iAd.Ext.Console.assert(b,"iAd.Ext.LocationLoader.getLocationsByCoordinate: Failed to provide longitude.");var c={};iAd.Utils.copyPropertiesFromSourceToTarget(this.myParams,c);c[iAd.Ext.FeedLoader.METHOD]=iAd.Ext.LocationLoader.METHOD_CORD_CALL;c[iAd.Ext.LocationLoader.LATITUDE]=a;c[iAd.Ext.LocationLoader.LONGITUDE]=b;this.params=
c;this.load()};iAd.Ext.LocationLoader.prototype.notifyLoaderDidComplete=function(){this.loaded=this.loading=false;this.zipCode=this.longitude=this.latitude=-1;try{var a=JSON.parse(this.content)}catch(b){this.notifyLoaderDidFail(iAd.Ext.LocationLoader.ERROR_BAD_DATA);return}this.checkDataForErrors(a)?this.dispatchLoaderNotification(iAd.Loader.DID_COMPLETE,[["response",a]]):this.notifyLoaderDidFail(iAd.Ext.LocationLoader.ERROR_NO_LOCATIONS)};
iAd.Ext.LocationLoader.prototype.checkDataForErrors=function(a){if(a)if(!a||!a.length||a.length<=0)return false;else{if(a[0]==="error")return false}else return false;return true};iAd.Class({name:"iAd.Ext.MapView",superclass:iAd.View,synthesizedProperties:["showsUserLocation","userLocation","mapRegion","mapType","selectedAnnotationId"],cssClassName:"ad-ext-map-view"});iAd.Ext.MapView.DID_ADD_ANNOTATIONS="mapViewDidAddViewsForAnnotations";iAd.Ext.MapView.DID_UPDATE_USER_LOCATION="mapViewDidUpdateUserLocation";
iAd.Ext.MapView.UPDATE_USER_LOCATION_FAILED="mapViewUpdateUserLocationFailed";iAd.Ext.MapView.DID_SELECT_ANNOTATION="mapViewDidSelectAnnotation";iAd.Ext.MapView.DID_DESELECT_ANNOTATION="mapViewDidDeselectAnnotation";iAd.Ext.MapView.ANNOTATION_LEFT_CALLOUT_TAPPED="mapViewAnnotationLeftCalloutTapped";iAd.Ext.MapView.ANNOTATION_RIGHT_CALLOUT_TAPPED="mapViewAnnotationRightCalloutTapped";iAd.Ext.MapView.REGION_DID_CHANGE="mapViewRegionDidChange";iAd.Ext.MapView.MAP_TYPE_STANDARD="standard";
iAd.Ext.MapView.MAP_TYPE_SATELLITE="satellite";iAd.Ext.MapView.MAP_TYPE_HYBRID="hybrid";iAd.Ext.MapView.MAP_TYPE_NOT_INITIALIZED="not-initialized";iAd.Ext.MapView.prototype.init=function(a){this._showsUserLocation=false;this._selectedAnnotationId=this._userLocation=null;this._mapRegion=iAd.Ext.MapRegion.US;this._mapType=iAd.Ext.MapView.MAP_TYPE_STANDARD;this.delegate=null;this._mapHasBeenShown=false;this.callSuper(a)};
iAd.Ext.MapView.prototype.layerWasCreated=function(){this.callSuper();if(!this._map)this._map=iAd.Ext.Map.mapFactory(),this._map.delegate=this,this._map.appendMapToView(this.layer)};iAd.Ext.MapView.prototype.setValueForAttribute=function(a,b){switch(b){case "ad-ext-map-type":this.mapType=a||iAd.Ext.MapView.MAP_TYPE_STANDARD;break;default:this.callSuper(a,b)}};iAd.Ext.MapView.prototype.updatePositionAndTransform=function(){this.callSuper();this.syncMapPositionAndSize()};
iAd.Ext.MapView.prototype.layerWasInsertedIntoDocument=function(){this.callSuper();this.syncMapPositionAndSize();if(!this._mapHasBeenShown)this._map.mapType=this.mapType,this._map.mapRegion=this.mapRegion,this._mapHasBeenShown=true;this._map.mapWasInsertedIntoDocument()};iAd.Ext.MapView.prototype.setShowsUserLocation=function(a){if(this._map)this._map.showsUserLocation=a};iAd.Ext.MapView.prototype.getShowsUserLocation=function(){return this._map?this._map.showsUserLocation:false};
iAd.Ext.MapView.prototype.getUserLocation=function(){return this._map?this._map.userLocation:null};iAd.Ext.MapView.prototype.setMapType=function(a){this._mapType=a;if(this._map)this._map.mapType=a};iAd.Ext.MapView.prototype.getMapType=function(){return this._map?this._map.mapType:iAd.Ext.MapView.MAP_TYPE_NOT_INITIALIZED};iAd.Ext.MapView.prototype.getSelectedAnnotationId=function(){return this._map?this._map.selectedAnnotationId:null};
iAd.Ext.MapView.prototype.setHidden=function(a){this._map.hidden=a;this.callSuper(a)};iAd.Ext.MapView.prototype.setSize=function(a){this.callSuper(a);this.syncMapPositionAndSize()};iAd.Ext.MapView.prototype.setMapRegion=function(a){this.setMapRegionAnimated(a,true)};iAd.Ext.MapView.prototype.setMapRegionAnimated=function(a,b){a&&this._map&&this._map.setMapRegionAnimated(a,b)};iAd.Ext.MapView.prototype.getMapRegion=function(){if(this._map)return this._map.mapRegion};
iAd.Ext.MapView.prototype.syncMapPositionAndSize=function(){this._map&&this._map.mapShouldUpdateLayoutInView(this._size,this._position)};iAd.Ext.MapView.prototype.centerMapByCoordinate=function(a,b){this._map&&this._map.centerMapByCoordinate(a,b===void 0||!!b)};iAd.Ext.MapView.prototype.addAnnotation=function(a){this._map&&this._map.addAnnotation(a)};iAd.Ext.MapView.prototype.zoomToAnnotations=function(a,b){this._map&&this._map.zoomToAnnotations(a,b===void 0||!!b)};
iAd.Ext.MapView.prototype.selectAnnotationWithId=function(a,b){this._map&&this._map.selectAnnotationWithId(a,b===void 0||!!b)};iAd.Ext.MapView.prototype.deselectAnnotationWithId=function(a){this._map&&this._map.deselectAnnotationWithId(a)};iAd.Ext.MapView.prototype.removeAnnotations=function(){this._map&&this._map.removeAnnotations()};iAd.Ext.MapView.prototype.removeAnnotationWithId=function(a){this._map&&this._map.removeAnnotationWithId(a)};
iAd.Ext.MapView.prototype.mapDidUpdateUserLocation=function(a,b,c){this.dispatchNotification(iAd.Ext.MapView.DID_UPDATE_USER_LOCATION,this.delegate,[["latitude",b],["longitude",c]])};iAd.Ext.MapView.prototype.mapDidSelectAnnotation=function(a,b){this.dispatchNotification(iAd.Ext.MapView.DID_SELECT_ANNOTATION,this.delegate,[["identifier",b]])};
iAd.Ext.MapView.prototype.mapDidDeselectAnnotation=function(a,b){this.dispatchNotification(iAd.Ext.MapView.DID_DESELECT_ANNOTATION,this.delegate,[["identifier",b]])};iAd.Ext.MapView.prototype.mapRegionDidChange=function(a,b){this.dispatchNotification(iAd.Ext.MapView.REGION_DID_CHANGE,this.delegate,[["region",b]])};iAd.Ext.MapView.prototype.mapDidAddViewsForAnnotations=function(a,b){this.dispatchNotification(iAd.Ext.MapView.DID_ADD_ANNOTATIONS,this.delegate,[["identifiers",b]])};
iAd.Ext.MapView.prototype.mapUpdateUserLocationFailed=function(){this.dispatchNotification(iAd.Ext.MapView.UPDATE_USER_LOCATION_FAILED,this.delegate)};iAd.Ext.MapView.prototype.mapAnnotationLeftCalloutTapped=function(a,b){this.dispatchNotification(iAd.Ext.MapView.ANNOTATION_LEFT_CALLOUT_TAPPED,this.delegate,[["annotationId",b]])};
iAd.Ext.MapView.prototype.mapAnnotationRightCalloutTapped=function(a,b){this.dispatchNotification(iAd.Ext.MapView.ANNOTATION_RIGHT_CALLOUT_TAPPED,this.delegate,[["annotationId",b]])};iAd.Class({name:"iAd.Ext.MediaAnalyticsDelegate",synthesizedProperties:["analyticsKey"]});iAd.Ext.MediaAnalyticsDelegate.ANALYTICS_SCREEN_UPDATE="screenupdate";iAd.Ext.MediaAnalyticsDelegate.ANALYTICS_PLAY_EVENT="play";iAd.Ext.MediaAnalyticsDelegate.ANALYTICS_PAUSE_EVENT="pause";
iAd.Ext.MediaAnalyticsDelegate.ANALYTICS_ENDED_EVENT="ended";iAd.Ext.MediaAnalyticsDelegate.ANALYTICS_SKIP_EVENT="skip";iAd.Ext.MediaAnalyticsDelegate.ANALYTICS_TIME_UPDATE_EVENT="timeupdate";iAd.Ext.MediaAnalyticsDelegate.PERCENT_PROGRESS_THRESHOLD=0.25;
iAd.Ext.MediaAnalyticsDelegate.prototype.init=function(a,b){this.callSuper();this.analyticsKey=a;this.delegate=b||null;this._mediaAnalyticsPrefix="";this._mediaObject=null;this._progressMilestones=[25,50,75];this._previousMilestone=null;this._logVideoScreenUpateAnalyticsOnNextPlayEvent=true;this._registerPassThroughMethods()};
iAd.Ext.MediaAnalyticsDelegate.prototype.setAnalyticsKey=function(a){iAd.Ext.Console.assert(iAd.Utils.objectIsString(a),"iAd.Ext.MediaAnalyticsDelegate: analyticsKey must be passed in as a string.");if(this._analyticsKey!=a)this._resetAnalyticVariables(),this._analyticsKey=a};
iAd.Ext.MediaAnalyticsDelegate.prototype._registerPassThroughMethods=function(){function a(a){return function(){c._notifyMediaDelegate(a,arguments)}}for(var b=[iAd.Media.DID_SEEK,iAd.Media.DID_UNLOAD,iAd.Media.LOAD_CAN_PLAY,iAd.Media.LOAD_CAN_PLAY_THROUGH,iAd.Media.LOAD_DATA_AVAILABLE,iAd.Media.LOAD_DID_FAIL,iAd.Media.LOAD_DID_PROGRESS,iAd.Media.LOAD_DID_RESUME,iAd.Media.LOAD_DID_STALL,iAd.Media.LOAD_DID_START,iAd.Media.LOAD_DID_SUSPEND,iAd.Media.LOAD_IS_READY,iAd.Media.LOAD_STATE_DID_UPDATE,iAd.Media.LOAD_WILL_START,
iAd.Media.PLAYBACK_DID_BEGIN_WAITING,iAd.Media.PLAYBACK_DID_END_WAITING,iAd.Media.PLAYBACK_STATE_DID_UPDATE,iAd.Media.PLAYBACK_WILL_START,iAd.Media.WILL_SEEK,iAd.Media.WILL_UNLOAD],c=this,d=0,f=b.length;d<f;++d){var g=b[d];this[g]=a(g)}};iAd.Ext.MediaAnalyticsDelegate.prototype._resetAnalyticVariables=function(){this._previousMilestone=null;this._logVideoScreenUpateAnalyticsOnNextPlayEvent=true};
iAd.Ext.MediaAnalyticsDelegate.prototype._analyticsPrefixForMedia=function(a){var b="";a instanceof iAd.Video?b="video":a instanceof iAd.Audio&&(b="audio");iAd.Console.assert(b,"iAd.Ext.MediaAnalyticsDelegate.prototype._analyticsPrefixForMedia - Unrecognized media type");return b};
iAd.Ext.MediaAnalyticsDelegate.prototype._logTimeUpdateAnalytics=function(a){var a=Math.floor(a/this._mediaObject.duration/iAd.Ext.MediaAnalyticsDelegate.PERCENT_PROGRESS_THRESHOLD)-1,b=this._progressMilestones[a];if(b&&!(this._previousMilestone>=b))this._logAnalyticsMessage(this._mediaAnalyticsPrefix+iAd.Ext.MediaAnalyticsDelegate.ANALYTICS_TIME_UPDATE_EVENT+b),this._previousMilestone=this._progressMilestones[a]};
iAd.Ext.MediaAnalyticsDelegate.prototype._notifyMediaDelegate=function(a,b){iAd.Utils.objectHasMethod(this.delegate,a)&&this.delegate[a].apply(this.delegate,b)};iAd.Ext.MediaAnalyticsDelegate.prototype._logAnalyticsMessage=function(a){this._mediaObject&&this._analyticsKey&&a&&adController.analytics.logMessage(this._analyticsKey+a)};
iAd.Ext.MediaAnalyticsDelegate.prototype._addMediaURIToPlayEventIfNeeded=function(){var a=this._analyticsKey.split("."),a=adController.analytics.eventDictionary[a[0]][a[1]+(this._mediaAnalyticsPrefix+iAd.Ext.MediaAnalyticsDelegate.ANALYTICS_PLAY_EVENT)];if(!a.uri){var b=this._stripFileNameFromPath(document.location.pathname);a.uri=b+this._mediaObject.resolvedURL}};
iAd.Ext.MediaAnalyticsDelegate.prototype.mediaPlaybackDidStart=function(){if(!this._mediaObject){var a=arguments[0];if(!(a instanceof iAd.Media))a=a.media;this._mediaObject=a;this._mediaAnalyticsPrefix=this._analyticsPrefixForMedia(a)}this._addMediaURIToPlayEventIfNeeded();if(this._logVideoScreenUpateAnalyticsOnNextPlayEvent)this._logAnalyticsMessage(iAd.Ext.MediaAnalyticsDelegate.ANALYTICS_SCREEN_UPDATE),this._logVideoScreenUpateAnalyticsOnNextPlayEvent=false;this._logAnalyticsMessage(this._mediaAnalyticsPrefix+
iAd.Ext.MediaAnalyticsDelegate.ANALYTICS_PLAY_EVENT);this._notifyMediaDelegate(iAd.Media.PLAYBACK_DID_START,arguments)};iAd.Ext.MediaAnalyticsDelegate.prototype._stripFileNameFromPath=function(a){return a.substr(1,a.lastIndexOf("/"))};iAd.Ext.MediaAnalyticsDelegate.prototype.mediaPlaybackDidPause=function(){this._logAnalyticsMessage(this._mediaAnalyticsPrefix+iAd.Ext.MediaAnalyticsDelegate.ANALYTICS_PAUSE_EVENT);this._notifyMediaDelegate(iAd.Media.PLAYBACK_DID_PAUSE,arguments)};
iAd.Ext.MediaAnalyticsDelegate.prototype.mediaPlaybackDidEnd=function(){this._logAnalyticsMessage(this._mediaAnalyticsPrefix+iAd.Ext.MediaAnalyticsDelegate.ANALYTICS_ENDED_EVENT);this._notifyMediaDelegate(iAd.Media.PLAYBACK_DID_END,arguments);this._resetAnalyticVariables()};iAd.Ext.MediaAnalyticsDelegate.prototype.mediaDidUpdateTime=function(){this._logTimeUpdateAnalytics(arguments[1]);this._notifyMediaDelegate(iAd.Media.DID_UPDATE_TIME,arguments)};
iAd.Ext.MediaAnalyticsDelegate.prototype.videoDidChangeFullscreen=function(a,b){!b&&this._mediaObject.playbackState==iAd.Media.PLAYBACK_STATE_PAUSED&&(this._logAnalyticsMessage(this._mediaAnalyticsPrefix+iAd.Ext.MediaAnalyticsDelegate.ANALYTICS_SKIP_EVENT),this._resetAnalyticVariables());this._notifyMediaDelegate(iAd.Video.DID_CHANGE_FULLSCREEN,arguments)};iAd.Ext.Utils=iAd.Ext.Utils||{};iAd.Ext.Utils.clampNegativeValue=iAd.Utils.clampNegativeValue||function(a,b){return a<0?b:a};
iAd.Ext.Utils.appendLocalizationCodeSuffix=function(a){iAd.RootViewController.sharedRootViewController.config.locale||iAd.Console.error("[iAd.Ext.Utils.appendLocalizationCodeSuffix] iAd.RootViewController.sharedRootViewController.config.locale does not exist.");return iAd.Ext.Utils.appendSuffixToPath(a,"_"+iAd.RootViewController.sharedRootViewController.config.locale)};
iAd.Ext.Utils.appendSuffixToPath=function(a,b){if(!a)return"";if(!b)return a;for(var c=a.length;c;){--c;if(a[c]==="/")break;if(a[c]===".")return a.substr(0,c)+b+a.substr(c)}return a+b};iAd.Ext.MediaStrategies={};iAd.Ext.MediaStrategies.IS_WIFI=!iAd.Ext.IS_IN_ADSHEET||window.ad.networkType===window.ADNetworkTypeListener.kADNetworkTypeListenerNetworkTypeWiFi;iAd.Ext.MediaStrategies.WIFI_VIDEO_SUFFIX="_hi";
iAd.Ext.MediaStrategies.defaultLoadReadyStrategy=function(a){return iAd.Ext.MediaStrategies.IS_WIFI?a.canPlay:a.canPlayThrough};iAd.Ext.MediaStrategies.defaultUrlStrategy=function(a){return iAd.Ext.MediaStrategies.IS_WIFI?iAd.Ext.Utils.appendSuffixToPath(a,iAd.Ext.MediaStrategies.WIFI_VIDEO_SUFFIX):a};iAd.Media.loadReadyStrategy=iAd.Ext.MediaStrategies.defaultLoadReadyStrategy;iAd.Media.urlStrategy=iAd.Ext.MediaStrategies.defaultUrlStrategy;iAd.Class({name:"iAd.Ext.Timer",mixins:[iAd.EventTarget]});
iAd.Ext.Timer.MINIMUM_TIMER_INTERVAL=1;iAd.Ext.Timer.TIMER_FIRED_EVENT="timerFired";iAd.Ext.Timer.prototype.init=function(a){this.callSuper();this._timerFiredFunction=null;this._timers=[];this._isPaused=false;this.delegate=null;iAd.Utils.objectIsFunction(a)?this._timerFiredFunction=a:this.delegate=a;this._repeatingTimerPointer=null;this._startTimeOfRepeatingTimer=this._lastScheduledInterval=this._repeatInterval=0};
iAd.Ext.Timer.prototype.startOneShot=function(a){this._isPaused?iAd.Console.error("iAd.Ext.Timer.startOneShot - Timer is paused."):this._timers.push(this._createTimerPointerAndStartTimer(iAd.Ext.Utils.clampNegativeValue(a,iAd.Ext.Timer.MINIMUM_TIMER_INTERVAL)))};
iAd.Ext.Timer.prototype.startRepeating=function(a){this._isPaused?iAd.Console.error("iAd.Ext.Timer.startRepeating - Timer is paused."):(this._repeatingTimerPointer&&this._stopRepeatingTimer(),this._startTimeOfRepeatingTimer=Date.now(),this._lastScheduledInterval=0,this._repeatInterval=iAd.Ext.Utils.clampNegativeValue(a,iAd.Ext.Timer.MINIMUM_TIMER_INTERVAL),this._repeatingTimerPointer=this._createTimerPointerAndStartTimer(this._repeatInterval))};
iAd.Ext.Timer.prototype.repeatInterval=function(){return this._repeatingTimerPointer?this._repeatInterval:0};iAd.Ext.Timer.prototype.isActive=function(){return!this._isPaused&&!(!this._repeatingTimerPointer&&!this._timers.length)};iAd.Ext.Timer.prototype.isPaused=function(){return this._isPaused};iAd.Ext.Timer.prototype.stop=function(){if(!this._isPaused){this._repeatingTimerPointer&&this._stopRepeatingTimer();for(var a in this._timers)window.clearTimeout(this._timers[a].timerId);this._timers=[]}};
iAd.Ext.Timer.prototype.pause=function(){if(!this._isPaused){this._isPaused=true;var a=Date.now();this._repeatingTimerPointer&&this._pauseTimerAtTime(this._repeatingTimerPointer,a);for(var b=0,c=this._timers.length;b<c;++b)this._pauseTimerAtTime(this._timers[b],a)}};iAd.Ext.Timer.prototype.resume=function(){if(this._isPaused){this._isPaused=false;this._repeatingTimerPointer&&this.startRepeating(this._repeatingTimerPointer.interval);var a=this._timers;this._timers=[];for(var b=0,c=a.length;b<c;++b)this.startOneShot(a[b].interval)}};
iAd.Ext.Timer.prototype.restartAllPendingTimers=function(){if(!this._isPaused){var a=this._repeatingTimerPointer,b=this._timers;this.stop();for(var c in b)this.startOneShot(b[c].interval);a&&this.startRepeating(this._repeatInterval)}};iAd.Ext.Timer.prototype._stopRepeatingTimer=function(){window.clearTimeout(this._repeatingTimerPointer.timerId);this._repeatingTimerPointer=null};
iAd.Ext.Timer.prototype._pauseTimerAtTime=function(a,b){window.clearTimeout(a.timerId);var c=b-a.timestamp;a.interval=a.interval>c?a.interval-c:0;a.timerId=null};iAd.Ext.Timer.prototype._createTimerPointerAndStartTimer=function(a){var b={timer:this,timerId:-1,interval:a,timestamp:Date.now()},a=this.callMethodNameAfterDelay("_timerFired",a,b);b.timerId=a;return b};
iAd.Ext.Timer.prototype._computeNextTimeInterval=function(){var a=(Date.now()-this._startTimeOfRepeatingTimer)/1E3,b=this._lastScheduledInterval+this._repeatInterval,c=b+this._repeatInterval;this._lastScheduledInterval=b;return(a>b?(Math.floor(a/this._repeatInterval)+1)*this._repeatInterval:c)-a};
iAd.Ext.Timer.prototype._timerFired=function(a){iAd.Ext.Console.assert(a.timer===this,"timerPointer.timer !== this");iAd.Ext.Console.assert(a.timerId!==-1,"timerPointer.timerId === -1");a!==this._repeatingTimerPointer&&iAd.Array.removeObjectFromArray(a,this._timers);this._timerFiredFunction&&this._timerFiredFunction(this);this.notifyDelegate(iAd.Ext.Timer.TIMER_FIRED_EVENT,this.delegate);if(a===this._repeatingTimerPointer)this._repeatingTimerPointer=this._createTimerPointerAndStartTimer(this._computeNextTimeInterval(a))};
iAd.Ext.TimerStrategy={};iAd.Ext.TimerStrategy.PauseOnTouchStart={handleTouchStart:function(a){a.timer.pause()},handleTouchEnd:function(a){a.timer.resume()},handleViewWillDisappear:function(a){a.timer.stop();a.releaseTimer()}};iAd.Ext.TimerStrategy.PauseOnTouchStartInAnyView={appliesToRootView:true};iAd.Utils.copyPropertiesFromSourceToTarget(iAd.Ext.TimerStrategy.PauseOnTouchStart,iAd.Ext.TimerStrategy.PauseOnTouchStartInAnyView);
iAd.Ext.TimerStrategy.CancelOnTouchStart={handleTouchStart:function(a){a.timer.stop();a.releaseTimer()},handleTouchEnd:function(){},handleViewWillDisappear:function(a){a.timer.stop();a.releaseTimer()}};iAd.Ext.TimerStrategy.CancelOnTouchStartInAnyView={appliesToRootView:true};iAd.Utils.copyPropertiesFromSourceToTarget(iAd.Ext.TimerStrategy.CancelOnTouchStart,iAd.Ext.TimerStrategy.CancelOnTouchStartInAnyView);
iAd.Ext.TimerStrategy.RestartOnTouchStart={handleTouchStart:function(a){a.timer.restartAllPendingTimers()},handleTouchEnd:function(){},handleViewWillDisappear:function(a){a.timer.stop();a.releaseTimer()}};iAd.Ext.TimerStrategy.RestartOnTouchStartInAnyView={appliesToRootView:true};iAd.Utils.copyPropertiesFromSourceToTarget(iAd.Ext.TimerStrategy.RestartOnTouchStart,iAd.Ext.TimerStrategy.RestartOnTouchStartInAnyView);
iAd.Class({name:"iAd.Ext.ViewControllerTimerStrategyProcessor",synthesizedProperties:["timer","timerStrategy"]});iAd.Ext.ViewControllerTimerStrategyProcessor.prototype.init=function(a,b,c){this.callSuper();this._viewController=a;this._viewToListenForTouchEvents=c.appliesToRootView?iAd.RootView.sharedRoot:a.view;this._timer=b;this._timerStrategy=c;this._setEnable(true)};iAd.Ext.ViewControllerTimerStrategyProcessor.prototype.setTimerStrategy=function(){};
iAd.Ext.ViewControllerTimerStrategyProcessor.prototype.isValid=function(){return this._viewController&&this._timer&&this._timerStrategy};iAd.Ext.ViewControllerTimerStrategyProcessor.prototype.releaseTimer=function(){this._setEnable(false);var a=this._timer;this._viewToListenForTouchEvents=this._viewController=this._timerStrategy=this._timer=null;return a};
iAd.Ext.ViewControllerTimerStrategyProcessor.prototype.handleEvent=function(a){switch(a.type){case iAd.Event.START_EVENT:this._timerStrategy.handleTouchStart(this,a);return;case iAd.Event.END_EVENT:this._timerStrategy.handleTouchEnd(this,a);return;case iAd.TransitionController.WILL_MAKE_VIEW_CONTROLLER_VISIBLE:a&&a.ad&&a.ad.sender.previouslyVisibleViewController===this._viewController&&this._timerStrategy.handleViewWillDisappear(this,a);return}iAd.Console.error("[iAd.Ext.ViewControllerTimerStrategyProcessor.handleEvent] Should not get here; got event type "+
a.type)};iAd.Ext.ViewControllerTimerStrategyProcessor.prototype._setEnable=function(a){a=a?"addEventListener":"removeEventListener";this._viewToListenForTouchEvents[a](iAd.Event.START_EVENT,this,true);this._viewToListenForTouchEvents[a](iAd.Event.END_EVENT,this,true);iAd.RootViewController.sharedRootViewController.transitionController[a](iAd.TransitionController.WILL_MAKE_VIEW_CONTROLLER_VISIBLE,this,false)};
iAd.Class({name:"iAd.Ext.TemplateViewController",superclass:iAd.ViewController,synthesizedProperties:["autoAdvanceAnimates","autoAdvanceDestinationViewController","autoAdvanceTimerStrategy"]});iAd.Ext.TemplateViewController.prototype.init=function(a){this.callSuper(a);var b=this;this._timer=new iAd.Ext.Timer(function(){b.autoAdvanceTimerFired()});this._timerStrategyProcessor=null;this._autoAdvanceDestinationViewControllerId="";this._autoAdvanceAnimates=true;this._autoAdvanceTimerStrategy=null};
iAd.Ext.TemplateViewController.prototype.viewDidUnload=function(){this.callSuper();this._timerStrategyProcessor&&this._timerStrategyProcessor.isValid()&&this._timerStrategyProcessor.releaseTimer()};iAd.Ext.TemplateViewController.prototype.setAutoAdvanceDestinationViewController=function(a){this._autoAdvanceDestinationViewControllerId=a.id};iAd.Ext.TemplateViewController.prototype.getAutoAdvanceDestinationViewController=function(){return adController.viewControllers[this._autoAdvanceDestinationViewControllerId]};
iAd.Ext.TemplateViewController.prototype._isAutoAdvanceEnabled=function(){return adController.config.isAutoAdvanceEnabled==void 0||!!adController.config.isAutoAdvanceEnabled};iAd.Ext.TemplateViewController.prototype.cancelAutoAdvance=function(){this._timer.stop()};iAd.Ext.TemplateViewController.prototype.isActiveAutoAdvanceTimer=function(){return this._timer.isActive()};
iAd.Ext.TemplateViewController.prototype.scheduleAutoAdvanceAfterDelay=function(a){if(this._isAutoAdvanceEnabled()){this._timer.stop();if(this._timerStrategyProcessor&&!this._timerStrategyProcessor.isValid())this.autoAdvanceTimerStrategy=this._autoAdvanceTimerStrategy;this._timer.startOneShot(a)}};
iAd.Ext.TemplateViewController.prototype.setAutoAdvanceTimerStrategy=function(a){if(this._isAutoAdvanceEnabled())this._autoAdvanceTimerStrategy=a,a=new iAd.Ext.ViewControllerTimerStrategyProcessor(this,this._timer,a),this._timerStrategyProcessor&&this._timerStrategyProcessor.isValid()&&this._timerStrategyProcessor.releaseTimer(),this._timerStrategyProcessor=a};
iAd.Ext.TemplateViewController.prototype.autoAdvanceTimerFired=function(){iAd.Ext.Console.assert(this._isAutoAdvanceEnabled(),"iAd.Ext.TemplateViewController.autoAdvanceTimerFired - Auto advance must be enabled");var a=adController.viewControllers[this._autoAdvanceDestinationViewControllerId];a&&adController.showViewController(a,this._autoAdvanceAnimates)};
